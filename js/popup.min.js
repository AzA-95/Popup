!function(t){var e=/Android|iPhone|iPad|iPod|BlackBerry|WPDesktop|IEMobile|Opera Mini/i.test(navigator.userAgent),o=/iPhone|iPad|iPod/i.test(navigator.userAgent),s=-1!==navigator.appVersion.indexOf("MSIE 10"),p=-1!==navigator.appVersion.indexOf("MSIE 9"),i=function(t,e){var s=document.createElement("div");return s.className=t,e&&e.appendChild(s),s};function n(){this.tags={},this.tags.popup=i("popup"+(s?" popup_ie10":"")+(p?" popup_ie9":""),document.body),this.tags.popup__overlay=i("popup__overlay",this.tags.popup),this.tags.popup__table=i("popup__table",this.tags.popup),this.tags.popup__cell=i("popup__cell",this.tags.popup__table),this.tags.popup__block=i("popup__block",this.tags.popup__cell),this.tags.popup__close=i("popup__close",this.tags.popup__block),this.tags.popup__change=i("popup__change",this.tags.popup__block),this.eventsTrigger=e?"touchend":"mouseup",this.events(),this.scrollWidth=this.scrollWidthElement(),this.defaults={clearClose:!0,bodyHidden:!0,addClassNamePopup:"",closeOverlay:!0,closeShow:!0,background:"",closeButtons:"",offsetY:0,offsetX:0,coordElement:""}}n.prototype={isOpen:!1,options:function(t){return this.defaults=this.extend({clearClose:!0,bodyHidden:!0,addClassNamePopup:"",closeOverlay:!0,closeShow:!0,background:"",closeButtons:"",offsetY:0,offsetX:0,coordElement:""},t),this.defaults.background&&(this.tags.popup.style.background=this.defaults.background),this},extend:function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);return t},addCloseButtons:function(){var o=this;this.defaults.closeButtons.split(",").forEach(function(t,e){var s=document.querySelectorAll(t.replace(/\s+/g,""));Array.prototype.forEach.call(s,function(t,e){t.addEventListener(o.eventsTrigger,function(t){return t.stopPropagation(),o.close(),!1},!1)})})},coordSet:function(){var t=document.querySelector(this.defaults.coordElement);return t&&(this.coords=t.getBoundingClientRect(),this.tags.popup__block.style.left=(this.defaults.bodyHidden?0:window.pageXOffset)+this.coords.left+this.defaults.offsetX+"px",this.tags.popup__block.style.top=(this.defaults.bodyHidden?0:window.pageYOffset)+this.coords.top+this.defaults.offsetY+"px",this.tags.popup__block.style.position="absolute"),this},coordReset:function(){var t=this;return this.defaults={clearClose:!0,bodyHidden:!0,addClassNamePopup:"",closeOverlay:!0,closeShow:!0,background:"",closeButtons:"",offsetY:0,offsetX:0,coordElement:""},setTimeout(function(){t.tags.popup.style.background=""},500),this.tags.popup__block.style.left="",this.tags.popup__block.style.top="",this.tags.popup__block.style.position="",this},setBodyStyle:function(){var t=window.innerHeight<document.body.scrollHeight;return this.defaults.bodyHidden&&(document.body.classList.add("popup__body_hidden"),t&&(document.body.style.paddingRight=this.scrollWidth+"px")),this},clearBodyStyle:function(){return document.body.classList.remove("popup__body_hidden"),document.body.style.paddingRight="",this},html:function(t,e){return $(this.tags.popup__change).html(t),e&&e.call(this.tags.popup,this.defaults,this.eventsTrigger),this},append:function(t,e){return $(this.tags.popup__change).html(t),e&&e.call(this.tags.popup,this.defaults,this.eventsTrigger),this.defaults.closeButtons&&this.addCloseButtons(),this},clear:function(t){return(this.defaults.clearClose||t)&&(this.tags.popup__change.innerHTML=""),this},show:function(t){return this.isOpen=!0,this.offsetTop=window.pageYOffset,document.body.style.top=-1*this.offsetTop+"px",this.tags.popup.className="popup",o&&document.documentElement.classList.add("popup_iphone"),this.defaults.closeShow?this.tags.popup__close.style.display="":this.tags.popup__close.style.display="none",this.setBodyStyle(),this.defaults.coordElement&&this.coordSet(),this.defaults.closeButtons&&this.addCloseButtons(),this.defaults.addClassNamePopup&&this.tags.popup.classList.add(this.defaults.addClassNamePopup),this.tags.popup.classList.add("popup_active"),t&&t.call(this.tags.popup,this.defaults,this.eventsTrigger),this},close:function(t,e){var s=this;return setTimeout(function(){s.tags.popup.classList.remove("popup_active"),o&&document.documentElement.classList.remove("popup_iphone"),s.defaults.addClassNamePopup&&s.tags.popup.classList.remove(s.defaults.addClassNamePopup),"clear"==t&&(s.tags.popup__change.innerHTML=""),s.coordReset(),e&&e.call(s.tags.popup,s.defaults,s.eventsTrigger),s.clearBodyStyle(),s.isOpen=!1,document.body.style.top="",window.scrollTo(0,s.offsetTop)},50),this},events:function(){var e=this;this.tags.popup__close.addEventListener(this.eventsTrigger,function(t){return t.stopPropagation(),e.close(),!1},!1),this.tags.popup__overlay.addEventListener(this.eventsTrigger,function(t){return t.stopPropagation(),e.defaults.closeOverlay&&e.close(),!1},!1),document.addEventListener("keydown",function(t){27==t.which&&e.close()},!1)},scrollWidthElement:function(){var t=document.createElement("div");t.style.overflowY="scroll",t.style.width="50px",t.style.height="50px",t.style.visibility="hidden",document.body.appendChild(t);var e=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),e}},window.Popup=n}(window);
